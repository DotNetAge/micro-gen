aggregates:
  - name: Photo
    description: "图片聚合根"
    fields:
      - name: Workflow
        type: string
        json: workflow
        description: "工作流ID"
        
      - name: Items
        type: "[]string"
        json: items
        description: "图片文件列表"
        
      - name: Videos
        type: "[]string"
        json: videos
        description: "视频文件列表"
        
      - name: State
        type: string
        json: state
        validate: required,oneof=pending audited published drafted
        description: "图片状态"
        
      - name: Tags
        type: "[]string"
        json: tags
        description: "标签列表"
        
      - name: Effects
        type: "[]string"
        json: effects
        description: "效果列表"
        
      - name: Width
        type: int
        json: width
        validate: required,min=1
        description: "图片宽度"
        
      - name: Height
        type: int
        json: height
        validate: required,min=1
        description: "图片高度"
        
      - name: VideoPrompt
        type: string
        json: video_prompt
        description: "视频提示词"
        
      - name: VideoPromptCn
        type: string
        json: video_prompt_cn
        description: "中文视频提示词"
        
      - name: Prompt
        type: string
        json: prompt
        description: "提示词"
        
      - name: Style
        type: string
        json: style
        description: "风格"
        
      - name: DetailStyle
        type: string
        json: detail_style
        description: "细节风格"
        
      - name: Positive
        type: string
        json: positive
        description: "正向提示词"
        
      - name: PositiveCn
        type: string
        json: positive_cn
        description: "中文正向提示词"
        
      - name: Negative
        type: string
        json: negative
        description: "负向提示词"
        
      - name: Loras
        type: "[]string"
        json: loras
        description: "LoRA列表"
        
      - name: BaseURL
        type: string
        json: base_url
        description: "基础URL"
        
      - name: HasVideo
        type: bool
        json: has_video
        default: false
        description: "是否有视频"
        
      - name: IsProcessing
        type: bool
        json: is_processing
        default: false
        description: "是否处理中"
        
      - name: Seed
        type: int
        json: seed
        description: "随机种子"
        

    events:
      - name: PhotoCreated
        description: "图片创建事件 - 严格按照架构文档定义"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required
            
          - name: Tags
            type: "[]string"
            json: tags
            
          - name: Width
            type: int
            json: width
            validate: required
            
          - name: Height
            type: int
            json: height
            validate: required
            
          - name: Positive
            type: string
            json: positive
            
          - name: Negative
            type: string
            json: negative
            
          - name: Seed
            type: int
            json: seed

      - name: PhotoStatusChanged
        description: "图片状态变更事件"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required
            
          - name: State
            type: string
            json: state
            validate: required

      - name: PhotoTagsUpdated
        description: "图片标签更新事件"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required
            
          - name: NewTags
            type: "[]string"
            json: new_tags

      - name: PhotoDeleted
        description: "图片删除事件"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required

      - name: PhotoSubItemDeleted
        description: "图片子项目删除事件"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required
            
          - name: File
            type: string
            json: file
            validate: required

    commands:
      - name: CreatePhoto
        description: "创建图片命令"
        fields:
          - name: SessionID
            type: string
            json: session_id
            validate: required
            
          - name: Positive
            type: string
            json: positive
            validate: required
            
          - name: Negative
            type: string
            json: negative
            validate: required
            
          - name: Width
            type: int
            json: width
            validate: required
            
          - name: Height
            type: int
            json: height
            validate: required
            
          - name: Seed
            type: int
            json: seed
            
          - name: Tags
            type: "[]string"
            json: tags
            
          - name: Effects
            type: "[]string"
            json: effects
            
          - name: Prompt
            type: string
            json: prompt
            
          - name: Style
            type: string
            json: style
            
          - name: DetailStyle
            type: string
            json: detail_style
            
          - name: PositiveCn
            type: string
            json: positive_cn

      - name: UpdatePhotoStatus
        description: "更新图片状态命令"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required
            
          - name: Status
            type: string
            json: status
            validate: required,oneof=pending audited published drafted

      - name: UpdatePhotoTags
        description: "更新图片标签命令"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required
            
          - name: Tags
            type: "[]string"
            json: tags
            validate: max=20

      - name: DeletePhoto
        description: "删除图片命令"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required

      - name: DeletePhotoSubItem
        description: "删除图片子项目命令"
        fields:
          - name: PhotoID
            type: string
            json: photo_id
            validate: required
            
          - name: File
            type: string
            json: file
            validate: required

      - name: QueryPhotos
        description: "批量查询图片命令"
        fields:
          - name: Page
            type: int
            json: page
            validate: required,min=1
            
          - name: PageSize
            type: int
            json: page_size
            validate: required,min=1,max=100
            
          - name: Status
            type: string
            json: status
            validate: oneof=pending audited published drafted
            
          - name: SortBy
            type: string
            json: sort_by
            validate: oneof=created_at updated_at view_count
            
          - name: SortOrder
            type: string
            json: sort_order
            validate: oneof=asc desc

projections:
  - name: PhotoSummaryProjection
    aggregate: Photo
    description: "图片摘要投影 - 用于分页查询"
    fields:
      - name: PhotoID
        type: string
        gorm: primaryKey
        
      - name: State
        type: string
        gorm: index
        
      - name: Width
        type: int
        
      - name: Height
        type: int
        
      - name: Tags
        type: "[]string"
        gorm: type:text[]
        
      - name: CreatedAt
        type: time.Time
        gorm: index

  - name: PhotoDetailProjection
    aggregate: Photo
    description: "图片详情投影 - 用于详情查询"
    fields:
      - name: PhotoID
        type: string
        gorm: primaryKey
        
      - name: Workflow
        type: string
        
      - name: Items
        type: "[]string"
        gorm: type:text[]
        
      - name: Videos
        type: "[]string"
        gorm: type:text[]
        
      - name: State
        type: string
        gorm: index
        
      - name: Tags
        type: "[]string"
        gorm: type:text[]
        
      - name: Effects
        type: "[]string"
        gorm: type:text[]
        
      - name: Width
        type: int
        
      - name: Height
        type: int
        
      - name: Prompt
        type: string
        
      - name: Style
        type: string
        
      - name: Positive
        type: string
        
      - name: Negative
        type: string
        
      - name: CreatedAt
        type: time.Time
        gorm: index

